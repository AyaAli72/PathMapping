# bumperbot_localization/config/ekf.yaml
ekf_filter_node:
    ros__parameters:
        # Core filter parameters
        frequency: 50.0
        sensor_timeout: 0.1
        two_d_mode: true
        print_diagnostics: true
        debug: false
        debug_out_file: "/tmp/ekf_debug.txt"
        
        # Frame configuration (Waffle-compatible)
        odom_frame: odom
        base_link_frame: base_footprint
        world_frame: odom
        map_frame: map
        transform_time_offset: 0.0
        transform_timeout: 0.0
        imu_timeout: 0.5
        
        # Process noise covariance (tuned for differential drive)
        process_noise_covariance: [0.05, 0,    0,    0,    0,    0,
                                  0,    0.05, 0,    0,    0,    0,
                                  0,    0,    0.06, 0,    0,    0,
                                  0,    0,    0,    0.03, 0,    0,
                                  0,    0,    0,    0,    0.03, 0,
                                  0,    0,    0,    0,    0,    0.06]

        # Odom input (from Gazebo Ignition)
        odom0: /model/bumperbot/odometry
        odom0_config: [true,   true,   false,  # x, y, z
                       false,  false,  true,   # roll, pitch, yaw
                       true,   true,   false,  # vx, vy, vz
                       false,  false,  true,   # vroll, vpitch, vyaw
                       false,  false,  false]  # ax, ay, az
        odom0_differential: false
        odom0_relative: false
        odom0_queue_size: 10
        odom0_pose_rejection_threshold: 5.0
        odom0_twist_rejection_threshold: 1.0

        # IMU input (if available)
        imu0: /imu/data
        imu0_config: [false,  false,  false,  # x, y, z
                      true,   true,   true,   # roll, pitch, yaw
                      false,  false,  false,  # vx, vy, vz
                      false,  false,  false,  # vroll, vpitch, vyaw
                      true,   true,   true]   # ax, ay, az
        imu0_differential: false
        imu0_queue_size: 10
        imu0_pose_rejection_threshold: 0.8
        imu0_twist_rejection_threshold: 0.8
        imu0_linear_acceleration_rejection_threshold: 1.0

        # Optional: Visual odometry input (uncomment if using)
        # vo0: /vo
        # vo0_config: [true, true, false,
        #              false, false, true,
        #              false, false, false,
        #              false, false, false,
        #              false, false, false]
        # vo0_queue_size: 10

        # Initial estimate covariance
        initial_estimate_covariance: [0.1, 0,    0,    0,    0,    0,
                                     0,    0.1, 0,    0,    0,    0,
                                     0,    0,    0.1, 0,    0,    0,
                                     0,    0,    0,    0.1, 0,    0,
                                     0,    0,    0,    0,    0.1, 0,
                                     0,    0,    0,    0,    0,    0.1]

        # Smoothing parameters
        smooth_lagged_data: true
        lag_duration: 0.5
        reset_on_time_jump: true

        # Topic remapping for Waffle compatibility
        publish_tf: true
        publish_acceleration: false
        publish_detail: false
        twist_prediction: false
